<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Progress</title>
    <style>
      /* Stil tanımlamaları buraya gelecek */
    </style>
</head>
<body>
    <div class="center">
        <div class="progress">
            <svg class="progress-bar" width="300" height="300">
                <circle class="progress-circle" cx="150" cy="150" r="135"></circle>
                <circle class="progress-circle progress-fill" cx="150" cy="150" r="135"></circle>
            </svg>
            <div class="text">
                <span class="progress-text">0</span>
                <span>Completed</span>
            </div>
            <div class="totalfilling">
                <h5 class="total-filling">0</h5>
            </div>
        </div>
    </div>

    <!-- Proje bilgilerini içeren tablo -->
    <table>
      <tr>
        <th>Proje Tipi</th>
        <th>Proje Adı</th>
        <th>Mesaj</th>
        <th>Fiyat</th>
        <th>Ödeme Linki</th>
        <th>GPU Sayısı</th>
        <th>Framerate</th>
        <th>Çözünürlük</th>
      </tr>
      <tr>
        <td id="project_type"></td>
        <td id="project_name"></td>
        <td id="message"></td>
        <td id="price"></td>
        <td id="payment_link"></td>
        <td id="gpu_count"></td>
        <td id="framerate"></td>
        <td id="resolution"></td>
      </tr>
    </table>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <script>
      const socket = io();

      const projectId = "{{ project_id }}";
      socket.emit('join_project', { project_id: projectId });

      // WebSocket üzerinden gelen proje güncellemesini yakalıyoruz
      socket.on('project_update', function(projectData) {
        document.getElementById('project_type').textContent = projectData.project_type;
        document.getElementById('project_name').textContent = projectData.project_name;
        document.getElementById('message').textContent = projectData.message;
        document.getElementById('price').textContent = projectData.price;
        document.getElementById('payment_link').textContent = projectData.payment_link;
        document.getElementById('gpu_count').textContent = projectData.gpu_count;
        document.getElementById('framerate').textContent = projectData.framerate;
        document.getElementById('resolution').textContent = projectData.resolution;

        // İlerleme çubuğunu güncelliyoruz
        setProgress(projectData.progress);
      });

      function setProgress(progressValue) {
        const circle = document.querySelector('.progress-fill');
        const progressText = document.querySelector('.progress-text');
        const totalFillingText = document.querySelector('.total-filling');
        const radius = circle.r.baseVal.value;
        const circumference = 2 * Math.PI * radius;

        const formattedProgress = parseFloat(progressValue).toFixed(2);
        const offset = circumference - (formattedProgress / 100) * circumference;

        circle.style.strokeDashoffset = offset;

        progressText.textContent = formattedProgress;
        totalFillingText.textContent = (formattedProgress * 1000 / 100).toFixed(0);
      }

      // Sayfa kapandığında sunucudan ayrılma işlemi
      window.addEventListener('beforeunload', function () {
        socket.emit('leave_project', { project_id: projectId });
      });
    </script>
</body>
</html>
